<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>知识库 - 生利达冷冻空调配件商城</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; }
        .article-card { transition: all 0.3s ease; }
        .article-card:hover { transform: translateY(-5px); box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-gray-50">
    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="flex items-center">
                        <i class="fas fa-snowflake text-4xl text-blue-600"></i>
                        <div class="ml-3">
                            <h1 class="text-2xl font-bold text-gray-900">生利达</h1>
                            <p class="text-xs text-gray-500">冷冻设备专家</p>
                        </div>
                    </a>
                </div>
                
                <div class="flex-1 max-w-xl mx-8">
                    <div class="relative">
                        <input type="text" id="searchInput" placeholder="搜索知识库..." 
                               class="w-full px-4 py-3 pr-12 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none">
                        <button onclick="handleSearch()" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                
                <div class="flex items-center space-x-6">
                    <a href="products.html" class="text-gray-700 hover:text-blue-600">产品中心</a>
                    <a href="diy-tool.html" class="text-gray-700 hover:text-blue-600">DIY配套</a>
                    <a href="index.html" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                        返回首页
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <section class="bg-gradient-to-r from-purple-600 to-blue-600 text-white py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="text-4xl font-bold mb-4">专业知识库</h1>
            <p class="text-xl text-purple-100">制冷技术知识中心 | 问题解答 | 技术文档</p>
        </div>
    </section>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex gap-8">
            <aside class="w-64 flex-shrink-0">
                <div class="bg-white rounded-xl shadow-lg p-6 sticky top-24">
                    <h3 class="font-bold text-lg mb-4">知识分类</h3>
                    <div id="categoryList" class="space-y-2">
                        <div class="cursor-pointer py-2 px-3 rounded-lg bg-blue-100 text-blue-600 font-semibold" data-category="" onclick="filterByCategory('')">
                            <i class="fas fa-th-large mr-2"></i>全部
                        </div>
                        <div class="cursor-pointer py-2 px-3 rounded-lg hover:bg-gray-100" data-category="选型指南" onclick="filterByCategory('选型指南')">
                            <i class="fas fa-book mr-2"></i>选型指南
                        </div>
                        <div class="cursor-pointer py-2 px-3 rounded-lg hover:bg-gray-100" data-category="维护保养" onclick="filterByCategory('维护保养')">
                            <i class="fas fa-tools mr-2"></i>维护保养
                        </div>
                        <div class="cursor-pointer py-2 px-3 rounded-lg hover:bg-gray-100" data-category="故障排查" onclick="filterByCategory('故障排查')">
                            <i class="fas fa-bug mr-2"></i>故障排查
                        </div>
                        <div class="cursor-pointer py-2 px-3 rounded-lg hover:bg-gray-100" data-category="安装指导" onclick="filterByCategory('安装指导')">
                            <i class="fas fa-wrench mr-2"></i>安装指导
                        </div>
                        <div class="cursor-pointer py-2 px-3 rounded-lg hover:bg-gray-100" data-category="行业资讯" onclick="filterByCategory('行业资讯')">
                            <i class="fas fa-newspaper mr-2"></i>行业资讯
                        </div>
                    </div>

                    <hr class="my-6">

                    <h3 class="font-bold text-lg mb-4">热门标签</h3>
                    <div id="tagCloud" class="flex flex-wrap gap-2">
                        <span class="px-3 py-1 bg-gray-100 rounded-full text-sm cursor-pointer hover:bg-blue-100" onclick="searchByTag('压缩机')">压缩机</span>
                        <span class="px-3 py-1 bg-gray-100 rounded-full text-sm cursor-pointer hover:bg-blue-100" onclick="searchByTag('冷库')">冷库</span>
                        <span class="px-3 py-1 bg-gray-100 rounded-full text-sm cursor-pointer hover:bg-blue-100" onclick="searchByTag('节能')">节能</span>
                        <span class="px-3 py-1 bg-gray-100 rounded-full text-sm cursor-pointer hover:bg-blue-100" onclick="searchByTag('温控')">温控</span>
                        <span class="px-3 py-1 bg-gray-100 rounded-full text-sm cursor-pointer hover:bg-blue-100" onclick="searchByTag('制冷剂')">制冷剂</span>
                    </div>
                </div>
            </aside>

            <main class="flex-1">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold">知识文章</h2>
                    <div class="text-gray-500">
                        共 <span id="totalArticles" class="font-bold text-blue-600">0</span> 篇文章
                    </div>
                </div>

                <div id="articleList" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="col-span-2 text-center py-12 text-gray-500">
                        <i class="fas fa-spinner fa-spin text-4xl mb-4"></i>
                        <p>加载中...</p>
                    </div>
                </div>

                <div id="pagination" class="mt-8 flex justify-center space-x-2"></div>
            </main>
        </div>
    </div>

    <div id="articleModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl mx-4 max-h-[90vh] overflow-hidden flex flex-col">
            <div class="p-6 border-b flex justify-between items-center">
                <h3 id="articleTitle" class="text-xl font-bold"></h3>
                <button onclick="closeArticleModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="articleContent" class="p-6 overflow-y-auto flex-1"></div>
            <div class="p-6 border-t bg-gray-50">
                <div class="flex items-center justify-between">
                    <div id="articleMeta" class="text-sm text-gray-500"></div>
                    <button onclick="markHelpful()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                        <i class="fas fa-thumbs-up mr-2"></i>这篇文章有帮助
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api/v1';
        let currentCategory = '';
        let currentPage = 1;
        let currentArticleId = null;

        const mockArticles = [
            {
                id: 1,
                title: '如何选择合适的压缩机',
                category: '选型指南',
                content: `<h2 class="text-xl font-bold mb-4">选择压缩机时需要考虑以下因素</h2>
                    <p class="mb-4">选择合适的压缩机是制冷系统设计的关键。以下是选型时需要考虑的主要因素：</p>
                    <h3 class="text-lg font-semibold mb-2">1. 制冷量需求</h3>
                    <p class="mb-4">根据应用场景的制冷量需求选择合适功率的压缩机。一般来说，冷库需要-25°C~0°C的低温，商超冷柜需要-5°C~5°C。</p>
                    <h3 class="text-lg font-semibold mb-2">2. 温度范围</h3>
                    <p class="mb-4">不同类型的压缩机适用于不同的温度范围。涡旋压缩机适合中高温应用，活塞压缩机适合低温应用。</p>
                    <h3 class="text-lg font-semibold mb-2">3. 制冷剂类型</h3>
                    <p class="mb-4">常用的制冷剂有R404A、R134a、R410A等，需要选择与制冷剂兼容的压缩机。</p>
                    <h3 class="text-lg font-semibold mb-2">4. 能效等级</h3>
                    <p class="mb-4">选择高能效等级的压缩机可以降低运行成本，建议选择A++或以上级别的产品。</p>`,
                tags: ['压缩机', '选型', '制冷系统'],
                viewCount: 1256,
                helpfulCount: 89,
                author: '技术部',
                createdAt: '2024-01-15'
            },
            {
                id: 2,
                title: '冷库日常维护指南',
                category: '维护保养',
                content: `<h2 class="text-xl font-bold mb-4">冷库日常维护要点</h2>
                    <p class="mb-4">定期的维护保养可以延长冷库使用寿命，保证制冷效果。</p>
                    <h3 class="text-lg font-semibold mb-2">每日检查</h3>
                    <ul class="list-disc pl-6 mb-4">
                        <li>检查压缩机运行状态，听是否有异常噪音</li>
                        <li>观察制冷剂压力表读数是否正常</li>
                        <li>检查冷凝器风扇是否正常运转</li>
                    </ul>
                    <h3 class="text-lg font-semibold mb-2">每周维护</h3>
                    <ul class="list-disc pl-6 mb-4">
                        <li>清洁冷凝器翅片，保持良好的换热效果</li>
                        <li>检查电气连接是否松动</li>
                        <li>记录运行温度和压力数据</li>
                    </ul>`,
                tags: ['冷库', '维护', '保养'],
                viewCount: 892,
                helpfulCount: 67,
                author: '技术部',
                createdAt: '2024-01-20'
            },
            {
                id: 3,
                title: '常见故障代码解析',
                category: '故障排查',
                content: `<h2 class="text-xl font-bold mb-4">制冷系统常见故障代码</h2>
                    <table class="w-full border-collapse mb-4">
                        <tr class="bg-gray-100"><th class="border p-2">故障代码</th><th class="border p-2">故障描述</th><th class="border p-2">解决方法</th></tr>
                        <tr><td class="border p-2">E01</td><td class="border p-2">压缩机过载保护</td><td class="border p-2">检查电压、冷凝器清洁度</td></tr>
                        <tr><td class="border p-2">E02</td><td class="border p-2">低压保护</td><td class="border p-2">检查制冷剂是否泄漏</td></tr>
                        <tr><td class="border p-2">E03</td><td class="border p-2">高压保护</td><td class="border p-2">检查冷凝器散热、风机运转</td></tr>
                        <tr><td class="border p-2">E04</td><td class="border p-2">温度传感器故障</td><td class="border p-2">检查传感器连接</td></tr>
                    </table>`,
                tags: ['故障', '排查', '维修'],
                viewCount: 1567,
                helpfulCount: 134,
                author: '技术部',
                createdAt: '2024-02-01'
            },
            {
                id: 4,
                title: '制冷系统安装流程',
                category: '安装指导',
                content: `<h2 class="text-xl font-bold mb-4">制冷系统安装标准流程</h2>
                    <h3 class="text-lg font-semibold mb-2">1. 现场勘查</h3>
                    <p class="mb-4">安装前需要对现场进行详细勘查，包括空间尺寸、通风条件、电源配置等。</p>
                    <h3 class="text-lg font-semibold mb-2">2. 设备定位</h3>
                    <p class="mb-4">根据设计方案确定压缩机、冷凝器、蒸发器的安装位置。</p>
                    <h3 class="text-lg font-semibold mb-2">3. 管道连接</h3>
                    <p class="mb-4">使用专业工具进行铜管焊接，确保管道连接密封可靠。</p>`,
                tags: ['安装', '指导', '施工'],
                viewCount: 678,
                helpfulCount: 45,
                author: '工程部',
                createdAt: '2024-02-10'
            }
        ];

        async function loadArticles() {
            const params = new URLSearchParams();
            if (currentCategory) params.append('category', currentCategory);
            params.append('page', currentPage);
            params.append('limit', 10);

            try {
                const res = await fetch(`${API_BASE}/knowledge?${params}`);
                let data;
                try {
                    data = await res.json();
                } catch {
                    data = { code: 200, data: { total: mockArticles.length, items: mockArticles } };
                }
                
                const articles = data.data?.items || mockArticles;
                document.getElementById('totalArticles').textContent = articles.length;

                if (articles.length === 0) {
                    document.getElementById('articleList').innerHTML = `
                        <div class="col-span-2 text-center py-12 text-gray-500">
                            <i class="fas fa-book-open text-6xl mb-4"></i>
                            <p>暂无相关文章</p>
                        </div>
                    `;
                    return;
                }

                const html = articles.map(a => `
                    <div class="article-card bg-white rounded-xl shadow-lg overflow-hidden cursor-pointer" onclick="viewArticle(${a.id})">
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-3">
                                <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">${a.category}</span>
                                <span class="text-sm text-gray-500">${a.createdAt || ''}</span>
                            </div>
                            <h3 class="text-lg font-bold mb-2 line-clamp-2">${a.title}</h3>
                            <div class="flex flex-wrap gap-2 mb-4">
                                ${(a.tags || []).map((t: string) => `<span class="text-xs text-gray-500">#${t}</span>`).join('')}
                            </div>
                            <div class="flex items-center justify-between text-sm text-gray-500">
                                <span><i class="fas fa-eye mr-1"></i>${a.viewCount || 0}</span>
                                <span><i class="fas fa-thumbs-up mr-1"></i>${a.helpfulCount || 0}</span>
                            </div>
                        </div>
                    </div>
                `).join('');

                document.getElementById('articleList').innerHTML = html;
            } catch (e) {
                document.getElementById('articleList').innerHTML = `
                    <div class="col-span-2 text-center py-12 text-gray-500">
                        <i class="fas fa-book-open text-6xl mb-4"></i>
                        <p>暂无相关文章</p>
                    </div>
                `;
            }
        }

        function viewArticle(id) {
            currentArticleId = id;
            const article = mockArticles.find(a => a.id === id);
            
            if (article) {
                document.getElementById('articleTitle').textContent = article.title;
                document.getElementById('articleContent').innerHTML = article.content;
                document.getElementById('articleMeta').innerHTML = `
                    <span class="mr-4"><i class="fas fa-user mr-1"></i>${article.author}</span>
                    <span class="mr-4"><i class="fas fa-eye mr-1"></i>${article.viewCount} 次浏览</span>
                    <span><i class="fas fa-thumbs-up mr-1"></i>${article.helpfulCount} 人觉得有帮助</span>
                `;
                document.getElementById('articleModal').classList.remove('hidden');
            }
        }

        function closeArticleModal() {
            document.getElementById('articleModal').classList.add('hidden');
        }

        function filterByCategory(category) {
            currentCategory = category;
            currentPage = 1;
            
            document.querySelectorAll('#categoryList > div').forEach(el => {
                el.classList.remove('bg-blue-100', 'text-blue-600', 'font-semibold');
                if (el.dataset.category === category) {
                    el.classList.add('bg-blue-100', 'text-blue-600', 'font-semibold');
                }
            });

            loadArticles();
        }

        function searchByTag(tag) {
            document.getElementById('searchInput').value = tag;
            handleSearch();
        }

        function handleSearch() {
            const q = document.getElementById('searchInput').value.trim();
            if (q) {
                window.location.href = `knowledge.html?q=${encodeURIComponent(q)}`;
            }
        }

        async function markHelpful() {
            if (currentArticleId) {
                try {
                    await fetch(`${API_BASE}/knowledge/${currentArticleId}/helpful`, { method: 'POST' });
                } catch (e) {}
                alert('感谢您的反馈！');
            }
        }

        loadArticles();
    </script>
</body>
</html>
