# ç”Ÿåˆ©è¾¾å†·å†»ç©ºè°ƒé…ä»¶å•†åŸ - å¼€å‘ä¸éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç›®å½•
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [æœ¬åœ°å¼€å‘](#æœ¬åœ°å¼€å‘)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [æ ¸å¿ƒåŠŸèƒ½å®ç°](#æ ¸å¿ƒåŠŸèƒ½å®ç°)
- [éƒ¨ç½²æ–¹æ¡ˆ](#éƒ¨ç½²æ–¹æ¡ˆ)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [å®‰å…¨ç­–ç•¥](#å®‰å…¨ç­–ç•¥)

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### ç³»ç»Ÿæ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·ç«¯                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   Web    â”‚  â”‚  Mobile  â”‚  â”‚  WeChat  â”‚          â”‚
â”‚  â”‚  Browser â”‚  â”‚   App    â”‚  â”‚ MiniApp  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚             â”‚             â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      Nginx / CDN          â”‚
         â”‚  (è´Ÿè½½å‡è¡¡ + é™æ€èµ„æº)      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     API Gateway           â”‚
         â”‚  (é‰´æƒ + é™æµ + è·¯ç”±)       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                  â”‚                  â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚ äº§å“æœåŠ¡ â”‚      â”‚  è®¢å•æœåŠ¡  â”‚     â”‚  ç”¨æˆ·æœåŠ¡  â”‚
â”‚ Service â”‚      â”‚  Service  â”‚     â”‚  Service  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”‚                  â”‚                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      Redis (ç¼“å­˜)         â”‚
         â”‚   Elasticsearch (æœç´¢)    â”‚
         â”‚   PostgreSQL (æ•°æ®åº“)     â”‚
         â”‚   MinIO (æ–‡ä»¶å­˜å‚¨)        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆé€‰å‹

#### å‰ç«¯æŠ€æœ¯æ ˆ
```javascript
{
  "æ¡†æ¶": "React 18 + Next.js 14",
  "çŠ¶æ€ç®¡ç†": "Zustand / Redux Toolkit",
  "UIç»„ä»¶": "Tailwind CSS + shadcn/ui",
  "3Dæ¸²æŸ“": "Three.js + React Three Fiber",
  "å›¾è¡¨": "Recharts / Chart.js",
  "HTTPå®¢æˆ·ç«¯": "Axios",
  "è¡¨å•": "React Hook Form + Zod",
  "å›½é™…åŒ–": "next-i18next"
}
```

#### åç«¯æŠ€æœ¯æ ˆ
```javascript
{
  "è¿è¡Œæ—¶": "Node.js 20 LTS",
  "æ¡†æ¶": "Express.js / Fastify",
  "ORM": "Prisma / TypeORM",
  "è®¤è¯": "JWT + Passport.js",
  "éªŒè¯": "Joi / Zod",
  "ä»»åŠ¡é˜Ÿåˆ—": "Bull (åŸºäºRedis)",
  "æ—¥å¿—": "Winston + Morgan",
  "APIæ–‡æ¡£": "Swagger / OpenAPI"
}
```

#### æ•°æ®åº“ä¸å­˜å‚¨
```javascript
{
  "å…³ç³»å‹æ•°æ®åº“": "PostgreSQL 15",
  "ç¼“å­˜": "Redis 7",
  "æœç´¢å¼•æ“": "Elasticsearch 8",
  "å¯¹è±¡å­˜å‚¨": "MinIO / é˜¿é‡Œäº‘OSS",
  "æ¶ˆæ¯é˜Ÿåˆ—": "RabbitMQ / Redis"
}
```

---

## ğŸ’» æœ¬åœ°å¼€å‘

### ç¯å¢ƒè¦æ±‚
- Node.js >= 18.0.0
- PostgreSQL >= 14.0
- Redis >= 6.0
- npm >= 9.0 æˆ– pnpm >= 8.0

### å¿«é€Ÿå¯åŠ¨

#### 1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/sld/sld-mall.git
cd sld-mall
```

#### 2. å®‰è£…ä¾èµ–
```bash
# å‰ç«¯ä¾èµ–
cd frontend
npm install

# åç«¯ä¾èµ–
cd ../backend
npm install
```

#### 3. ç¯å¢ƒé…ç½®
```bash
# åç«¯ç¯å¢ƒå˜é‡
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶
DATABASE_URL="postgresql://user:password@localhost:5432/sld_mall"
REDIS_URL="redis://localhost:6379"
JWT_SECRET="your-secret-key"
PORT=3000
```

#### 4. åˆå§‹åŒ–æ•°æ®åº“
```bash
cd backend

# è¿è¡Œæ•°æ®åº“è¿ç§»
npm run migrate

# å¯¼å…¥åˆå§‹æ•°æ®
npm run seed
```

#### 5. å¯åŠ¨æœåŠ¡

```bash
# ç»ˆç«¯1: å¯åŠ¨åç«¯
cd backend
npm run dev
# è¿è¡Œåœ¨ http://localhost:3000

# ç»ˆç«¯2: å¯åŠ¨å‰ç«¯
cd frontend
npm run dev
# è¿è¡Œåœ¨ http://localhost:3001
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
sld-mall/
â”œâ”€â”€ frontend/                    # å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ public/                  # é™æ€èµ„æº
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/                 # Next.js App Router
â”‚   â”‚   â”‚   â”œâ”€â”€ (shop)/         # å•†åŸé¡µé¢ç»„
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx    # é¦–é¡µ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ products/   # äº§å“åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ diy/        # DIYå·¥å…·
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ solutions/  # è§£å†³æ–¹æ¡ˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ (account)/      # è´¦æˆ·é¡µé¢ç»„
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ profile/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ orders/
â”‚   â”‚   â”‚   â””â”€â”€ api/            # APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ components/          # ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/             # åŸºç¡€UIç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ product/        # äº§å“ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ diy/            # DIYå·¥å…·ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ layout/         # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ lib/                # å·¥å…·åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts          # APIå®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts         # è®¤è¯å·¥å…·
â”‚   â”‚   â”‚   â””â”€â”€ utils.ts        # é€šç”¨å·¥å…·
â”‚   â”‚   â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”œâ”€â”€ store/              # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ types/              # TypeScriptç±»å‹
â”‚   â”‚   â””â”€â”€ styles/             # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ next.config.js
â”‚
â”œâ”€â”€ backend/                     # åç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ routes/             # è·¯ç”±å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.routes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ products.routes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ diy.routes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ orders.routes.ts
â”‚   â”‚   â”‚   â””â”€â”€ solutions.routes.ts
â”‚   â”‚   â”œâ”€â”€ controllers/        # æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ products.controller.ts
â”‚   â”‚   â”‚   â””â”€â”€ diy.controller.ts
â”‚   â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ product.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ recommendation.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ compatibility.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ order.service.ts
â”‚   â”‚   â”œâ”€â”€ models/             # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ user.model.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ product.model.ts
â”‚   â”‚   â”‚   â””â”€â”€ order.model.ts
â”‚   â”‚   â”œâ”€â”€ middlewares/        # ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.middleware.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ error.middleware.ts
â”‚   â”‚   â”‚   â””â”€â”€ validation.middleware.ts
â”‚   â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ config/             # é…ç½®
â”‚   â”‚   â””â”€â”€ app.ts              # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ prisma/                 # Prismaé…ç½®
â”‚   â”‚   â”œâ”€â”€ schema.prisma
â”‚   â”‚   â””â”€â”€ migrations/
â”‚   â”œâ”€â”€ tests/                  # æµ‹è¯•
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ database/                    # æ•°æ®åº“è„šæœ¬
â”‚   â”œâ”€â”€ schema.sql
â”‚   â”œâ”€â”€ seeds/
â”‚   â”‚   â”œâ”€â”€ categories.sql
â”‚   â”‚   â”œâ”€â”€ products.sql
â”‚   â”‚   â””â”€â”€ solutions.sql
â”‚   â””â”€â”€ migrations/
â”‚
â”œâ”€â”€ docs/                        # æ–‡æ¡£
â”‚   â”œâ”€â”€ API.md                  # APIæ–‡æ¡£
â”‚   â”œâ”€â”€ DEPLOYMENT.md           # éƒ¨ç½²æ–‡æ¡£
â”‚   â””â”€â”€ DEVELOPMENT.md          # å¼€å‘æ–‡æ¡£
â”‚
â”œâ”€â”€ docker/                      # Dockeré…ç½®
â”‚   â”œâ”€â”€ Dockerfile.frontend
â”‚   â”œâ”€â”€ Dockerfile.backend
â”‚   â””â”€â”€ docker-compose.yml
â”‚
â”œâ”€â”€ .github/                     # GitHubé…ç½®
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ ci.yml
â”‚       â””â”€â”€ deploy.yml
â”‚
â””â”€â”€ README.md
```

---

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. æ™ºèƒ½æ¨èç®—æ³•

```typescript
// backend/src/services/recommendation.service.ts

class RecommendationService {
  /**
   * æ™ºèƒ½æ¨èé…ä»¶
   */
  async recommendProducts(requirements: DIYRequirements): Promise<Recommendation> {
    // 1. è§£æéœ€æ±‚å‚æ•°
    const parsedReq = this.parseRequirements(requirements);
    
    // 2. åŸºäºè§„åˆ™åŒ¹é…å€™é€‰äº§å“
    const candidates = await this.findCandidateProducts(parsedReq);
    
    // 3. è®¡ç®—åŒ¹é…åˆ†æ•°
    const scored = this.calculateMatchScores(candidates, parsedReq);
    
    // 4. éªŒè¯é…ä»¶å…¼å®¹æ€§
    const compatible = await this.validateCompatibility(scored);
    
    // 5. ä¼˜åŒ–ç»„åˆæ–¹æ¡ˆ
    const optimized = this.optimizeCombination(compatible, parsedReq.options);
    
    // 6. ç”Ÿæˆæ¨èç»“æœ
    return this.buildRecommendation(optimized, parsedReq);
  }
  
  /**
   * è®¡ç®—äº§å“åŒ¹é…åˆ†æ•°
   */
  private calculateMatchScores(products: Product[], requirements: any) {
    return products.map(product => ({
      ...product,
      matchScore: this.computeScore(product, requirements)
    })).sort((a, b) => b.matchScore - a.matchScore);
  }
  
  /**
   * è®¡ç®—å•ä¸ªäº§å“åˆ†æ•°
   */
  private computeScore(product: Product, requirements: any): number {
    let score = 0;
    
    // åˆ¶å†·é‡åŒ¹é… (æƒé‡: 40%)
    const capacityMatch = this.matchCoolingCapacity(
      product.specifications.cooling_capacity,
      requirements.coolingCapacity
    );
    score += capacityMatch * 40;
    
    // æ¸©åº¦é€‚åº”æ€§ (æƒé‡: 30%)
    const tempMatch = this.matchTemperatureRange(
      product.specifications.temp_range,
      requirements.temperatureRange
    );
    score += tempMatch * 30;
    
    // èƒ½æ•ˆç­‰çº§ (æƒé‡: 20%)
    if (requirements.options.energySaving) {
      score += this.getEnergyScore(product.specifications.energy_efficiency) * 20;
    }
    
    // å“ç‰Œåå¥½ (æƒé‡: 10%)
    if (requirements.preferredBrands?.includes(product.brand)) {
      score += 10;
    }
    
    return Math.min(score, 100);
  }
}
```

### 2. å…¼å®¹æ€§éªŒè¯ç³»ç»Ÿ

```typescript
// backend/src/services/compatibility.service.ts

class CompatibilityService {
  /**
   * éªŒè¯äº§å“ç»„åˆå…¼å®¹æ€§
   */
  async validateCombination(productIds: number[]): Promise<CompatibilityResult> {
    const products = await this.getProducts(productIds);
    const matrix = await this.buildCompatibilityMatrix(products);
    
    const errors: CompatibilityError[] = [];
    const warnings: CompatibilityWarning[] = [];
    
    // æ£€æŸ¥åˆ¶å†·å‰‚å…¼å®¹æ€§
    this.checkRefrigerantCompatibility(products, errors);
    
    // æ£€æŸ¥ç”µæ°”å‚æ•°åŒ¹é…
    this.checkElectricalCompatibility(products, errors);
    
    // æ£€æŸ¥å®¹é‡åŒ¹é…
    this.checkCapacityMatching(products, warnings);
    
    // æ£€æŸ¥ç‰©ç†æ¥å£
    this.checkPhysicalInterface(products, errors);
    
    return {
      compatible: errors.length === 0,
      errors,
      warnings,
      matrix
    };
  }
  
  /**
   * æ£€æŸ¥åˆ¶å†·å‰‚å…¼å®¹æ€§
   */
  private checkRefrigerantCompatibility(products: Product[], errors: any[]) {
    const refrigerants = products
      .map(p => p.specifications.refrigerant)
      .filter(r => r);
    
    const uniqueRefrigerants = [...new Set(refrigerants)];
    
    if (uniqueRefrigerants.length > 1) {
      errors.push({
        type: 'refrigerant_mismatch',
        message: `æ£€æµ‹åˆ°å¤šç§åˆ¶å†·å‰‚: ${uniqueRefrigerants.join(', ')}`,
        severity: 'error',
        affectedProducts: products.filter(p => 
          p.specifications.refrigerant
        ).map(p => p.id)
      });
    }
  }
}
```

### 3. 3Då¯è§†åŒ–ç»„ä»¶

```typescript
// frontend/src/components/diy/ProductViewer3D.tsx

import { Canvas } from '@react-three/fiber';
import { OrbitControls, useGLTF } from '@react-three/drei';

export function ProductViewer3D({ products }: { products: Product[] }) {
  return (
    <Canvas camera={{ position: [0, 0, 5] }}>
      <ambientLight intensity={0.5} />
      <spotLight position={[10, 10, 10]} angle={0.15} />
      
      {products.map((product, index) => (
        <ProductModel
          key={product.id}
          url={product.model3d}
          position={[index * 2, 0, 0]}
        />
      ))}
      
      <OrbitControls />
    </Canvas>
  );
}

function ProductModel({ url, position }: any) {
  const { scene } = useGLTF(url);
  return <primitive object={scene} position={position} />;
}
```

---

## ğŸš€ éƒ¨ç½²æ–¹æ¡ˆ

### Dockeréƒ¨ç½²

#### docker-compose.yml
```yaml
version: '3.8'

services:
  # PostgreSQLæ•°æ®åº“
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: sld_mall
      POSTGRES_USER: sld_user
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./database/init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "5432:5432"
    networks:
      - sld-network

  # Redisç¼“å­˜
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - sld-network

  # Elasticsearchæœç´¢å¼•æ“
  elasticsearch:
    image: elasticsearch:8.11.0
    environment:
      - discovery.type=single-node
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    volumes:
      - es_data:/usr/share/elasticsearch/data
    ports:
      - "9200:9200"
    networks:
      - sld-network

  # åç«¯APIæœåŠ¡
  backend:
    build:
      context: ./backend
      dockerfile: ../docker/Dockerfile.backend
    environment:
      NODE_ENV: production
      DATABASE_URL: postgresql://sld_user:${DB_PASSWORD}@postgres:5432/sld_mall
      REDIS_URL: redis://redis:6379
      ELASTICSEARCH_URL: http://elasticsearch:9200
    ports:
      - "3000:3000"
    depends_on:
      - postgres
      - redis
      - elasticsearch
    networks:
      - sld-network

  # å‰ç«¯åº”ç”¨
  frontend:
    build:
      context: ./frontend
      dockerfile: ../docker/Dockerfile.frontend
    environment:
      NEXT_PUBLIC_API_URL: http://backend:3000/api
    ports:
      - "3001:3000"
    depends_on:
      - backend
    networks:
      - sld-network

  # Nginxåå‘ä»£ç†
  nginx:
    image: nginx:alpine
    volumes:
      - ./docker/nginx.conf:/etc/nginx/nginx.conf
      - ./frontend/public:/usr/share/nginx/html/static
    ports:
      - "80:80"
      - "443:443"
    depends_on:
      - frontend
      - backend
    networks:
      - sld-network

volumes:
  postgres_data:
  redis_data:
  es_data:

networks:
  sld-network:
    driver: bridge
```

### äº‘æœåŠ¡éƒ¨ç½²(é˜¿é‡Œäº‘)

#### 1. æœåŠ¡å™¨é…ç½®
```
ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®:
- ECS: 4æ ¸8G (2å°,åšè´Ÿè½½å‡è¡¡)
- RDS PostgreSQL: 2æ ¸4G
- Redis: 2Gæ ‡å‡†ç‰ˆ
- OSS: æ ‡å‡†å­˜å‚¨
- SLB: è´Ÿè½½å‡è¡¡å™¨
```

#### 2. CI/CDæµç¨‹
```yaml
# .github/workflows/deploy.yml
name: Deploy to Production

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Build Docker Images
        run: |
          docker build -t sld-frontend ./frontend
          docker build -t sld-backend ./backend
      
      - name: Push to Registry
        run: |
          docker tag sld-frontend registry.cn-shenzhen.aliyuncs.com/sld/frontend:latest
          docker tag sld-backend registry.cn-shenzhen.aliyuncs.com/sld/backend:latest
          docker push registry.cn-shenzhen.aliyuncs.com/sld/frontend:latest
          docker push registry.cn-shenzhen.aliyuncs.com/sld/backend:latest
      
      - name: Deploy to Server
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_KEY }}
          script: |
            cd /opt/sld-mall
            docker-compose pull
            docker-compose up -d
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ä¼˜åŒ–
```sql
-- æ·»åŠ ç´¢å¼•
CREATE INDEX idx_products_category ON products(category_id);
CREATE INDEX idx_products_brand ON products(brand);
CREATE INDEX idx_orders_user_status ON orders(user_id, status);
CREATE INDEX idx_order_items_product ON order_items(product_id);

-- å…¨æ–‡æœç´¢ç´¢å¼•
CREATE INDEX idx_products_fulltext ON products 
USING gin(to_tsvector('chinese', name || ' ' || description));

-- åˆ†åŒºè¡¨(è®¢å•è¡¨æŒ‰æœˆåˆ†åŒº)
CREATE TABLE orders_2024_01 PARTITION OF orders
FOR VALUES FROM ('2024-01-01') TO ('2024-02-01');
```

### 2. ç¼“å­˜ç­–ç•¥
```typescript
// äº§å“åˆ—è¡¨ç¼“å­˜ - 5åˆ†é’Ÿ
redis.setex(`products:list:${category}:${page}`, 300, JSON.stringify(products));

// äº§å“è¯¦æƒ…ç¼“å­˜ - 1å°æ—¶
redis.setex(`product:${id}`, 3600, JSON.stringify(product));

// çƒ­é—¨æœç´¢ç¼“å­˜ - 10åˆ†é’Ÿ
redis.setex('search:hot', 600, JSON.stringify(hotKeywords));
```

### 3. CDNåŠ é€Ÿ
```
é™æ€èµ„æºé€šè¿‡é˜¿é‡Œäº‘CDNåŠ é€Ÿ:
- å›¾ç‰‡: https://cdn.sld-mall.com/images/
- JS/CSS: https://cdn.sld-mall.com/assets/
- 3Dæ¨¡å‹: https://cdn.sld-mall.com/models/
```

---

## ğŸ”’ å®‰å…¨ç­–ç•¥

### 1. æ•°æ®åŠ å¯†
```typescript
// å¯†ç åŠ å¯†
import bcrypt from 'bcrypt';
const hashedPassword = await bcrypt.hash(password, 10);

// JWT Token
import jwt from 'jsonwebtoken';
const token = jwt.sign({ userId, role }, JWT_SECRET, { expiresIn: '7d' });

// æ•æ„Ÿæ•°æ®åŠ å¯†
import crypto from 'crypto';
const encrypted = crypto.createCipher('aes-256-cbc', SECRET_KEY);
```

### 2. SQLæ³¨å…¥é˜²æŠ¤
```typescript
// ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
const result = await db.query(
  'SELECT * FROM products WHERE id = $1',
  [productId]
);
```

### 3. XSSé˜²æŠ¤
```typescript
// è¾“å‡ºè½¬ä¹‰
import DOMPurify from 'dompurify';
const clean = DOMPurify.sanitize(userInput);
```

### 4. CSRFé˜²æŠ¤
```typescript
// CSRF TokenéªŒè¯
app.use(csrf({ cookie: true }));
```

---

## ğŸ“Š ç›‘æ§ä¸æ—¥å¿—

### åº”ç”¨ç›‘æ§
```javascript
// ä½¿ç”¨PM2è¿›è¡Œè¿›ç¨‹ç®¡ç†
{
  "apps": [{
    "name": "sld-backend",
    "script": "./dist/app.js",
    "instances": 4,
    "exec_mode": "cluster",
    "max_memory_restart": "500M",
    "env": {
      "NODE_ENV": "production"
    }
  }]
}
```

### æ—¥å¿—ç³»ç»Ÿ
```typescript
// Winstonæ—¥å¿—é…ç½®
import winston from 'winston';

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.json(),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' })
  ]
});
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- æ–‡æ¡£: https://docs.sld-mall.com
- GitHub: https://github.com/sld/sld-mall
- æŠ€æœ¯æ”¯æŒ: tech@sld.com
