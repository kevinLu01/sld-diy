# Step2 优化建议（功能设计 + 代码专业度）

## 1) 功能设计优化（优先级）

1. P0: 数据模型单轨化
- 目标: 统一 `t_*` 与 CamelCase 双表体系，避免读写分裂和隐性脏数据。
- 建议: 以 `t_*` 为生产主模型，迁移脚本一次性清理旧表写入路径。

2. P0: DIY 方案可执行性闭环
- 现状: `solutions/create-order` 仍可能因方案无产品而业务失败。
- 建议: 后台强约束“方案发布前必须绑定>=1产品”；前台在提交前展示校验结果。

3. P1: 服务工单状态机
- 现状: 评价依赖“已完成”状态，业务规则合理但操作路径不透明。
- 建议: 增加工单状态流转接口（待处理->处理中->已完成）和后台操作入口。

4. P1: 后台 CRUD 可观测性
- 建议: 后台列表页增加最近变更记录、操作审计（操作者、时间、字段diff）。

5. P2: DIY 推荐可解释性
- 建议: 在推荐结果中返回“命中规则/不命中原因/兼容性评分分项”，提升业务可信度。

## 2) 代码专业度优化

1. P0: 统一鉴权用户ID解析
- 现状: 多控制器重复写 `resolveUserId`。
- 建议: 提供统一 `CurrentUserResolver`（参数解析器或工具类）+ 注解获取当前用户。

2. P0: DTO 与实体字段契约治理
- 建议: 为 admin/user/diy/order 建立契约测试（Contract Test），防止字段名漂移。

3. P1: 统一错误语义
- 建议: 区分“业务可预期错误（4xx语义）”与“系统错误（5xx）”，避免前端误判。

4. P1: 集成测试覆盖关键写链路
- 建议: 增加 CI 集成测试：注册->DIY->购物车->下单->后台CRUD。

5. P1: SQL 映射规范
- 建议: 强制显式列映射（snake_case <-> camelCase），禁止隐式映射依赖。

6. P2: 可维护性工程化
- 建议: 引入模块级 lint/checkstyle 规则、架构边界检查、自动化迁移脚本审查。

## 3) 建议实施路线图

1. 第1周（止血）
- 完成数据模型单轨设计与迁移方案
- 补齐统一用户解析组件
- 固化关键链路集成测试

2. 第2周（增强）
- 完成 DIY/方案发布前置校验
- 完成服务工单状态流转后台入口
- 上线操作审计与变更日志

3. 第3周（优化）
- DIY 推荐解释能力
- API 契约版本化与文档自动生成
- 清理历史兼容路径
