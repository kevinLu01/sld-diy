# Step2-J DIY可配置化与私发报价 任务清单

## 目标
- 让系统支持真实空调冷冻配件场景下的“自定义场景 + 自定义主件/辅件 + 私发折扣报价链接”。
- 每个子任务执行顺序固定：设计/开发 -> 单元测试 -> 业务流程测试 -> 进度通知。

## 业务调研结论（真实场景映射）
- 典型场景：冷库（高/中/低温库）、商超冷陈列、冷链运输、中央空调机房、工业工艺降温、医药冷藏、数据中心精密空调。
- 配套思路：可类比电脑 DIY，按“场景 -> 主件（压缩机/冷凝机组/蒸发器）-> 辅件（阀件/控制器/冷媒/保温/监控）-> 安装服务”组织。
- 商业链路：大量项目采用“顾问报价 + 私下折扣 + 专属链接确认”，并不会自动公开上架。

## 子任务拆分

### J1（P0）数据模型扩展
- [x] J1.1 设计字段：DIY推荐增加 `componentRole`（main/auxiliary）
- [x] J1.2 设计字段：DIY方案增加私发报价字段（折扣、报价金额、私发模式、过期时间）
- [x] J1.3 新增数据库迁移 + 回滚脚本
- [x] J1.4 同步测试 schema

验收:
- 推荐配置可标记主件/辅件
- 方案可生成“私发折扣链接”且不进入公开方案列表

### J2（P0）后端接口改造
- [x] J2.1 `GET /api/v1/diy/config` 返回动态场景与组件角色配置
- [x] J2.2 `POST /api/v1/diy/recommend` 返回分组推荐（主件/辅件）
- [x] J2.3 `POST /api/v1/diy/projects/{id}/share` 支持私发报价参数
- [x] J2.4 新增后台私发报价接口（按项目生成私享链接）

验收:
- 支持自定义场景、自定义主件/辅件推荐
- 支持私发链接生成、查询、过期校验

### J3（P0）后台配置能力
- [x] J3.1 管理端 DIY 推荐配置新增“组件角色”
- [x] J3.2 管理端 DIY 配置新增“自定义场景/角色配置”入口
- [x] J3.3 管理端新增“私发报价列表/创建”

验收:
- 后台可独立配置并驱动前台动态展示

### J4（P0）前台DIY交互升级
- [x] J4.1 场景从后端配置动态加载
- [x] J4.2 增加“自定义场景”输入
- [x] J4.3 推荐结果按主件/辅件分区展示
- [x] J4.4 DIY项目页支持生成私发折扣链接

验收:
- 用户可完成完整“选场景->选主辅件->生成私发报价链接”

### J5（P0）测试与回归
- [x] J5.1 单元测试：服务层推荐/分享逻辑
- [x] J5.2 集成测试：API关键链路
- [ ] J5.3 业务流程测试：前台 + 后台点击流
- [ ] J5.4 结果回写进度文档

验收:
- 单测通过
- 核心业务链路回归通过

## 本轮执行顺序
1. J1
2. J2
3. J5（后端部分）
4. J3
5. J4
6. J5（全链路）
